// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  user_id    Int       @id
  nick_name  String    @unique
  state      Int       @default(0)
  img_name   String?   @default("default.png")
  win        Int       @default(0)
  lose       Int       @default(0)
  ladder     Int       @default(1000)
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt
  twoFA      Boolean   @default(false)
  twoFA_key  String?
  friends    Friends[] @relation("following_user")
  games      Game[]    @relation("game_user")
  tokens     Tokens[]  @relation("token_user")
  events     Event[]   @relation("event_user")
}

model Friends {
    id                      Int      @default(autoincrement()) @id
    following_user          User     @relation("following_user", fields: [following_user_id], references: [user_id])
    following_user_id       Int
    following_user_nickname String
    followed_user_id        Int
    followed_user_nickname  String
    created_at              DateTime @default(now())
}

model Tokens {
    user_id        Int      @id
    user           User     @relation("token_user", fields: [user_id], references: [user_id])
    nick_name      String   @unique
    access_token   String?
    refresh_token  String?
    created_at     DateTime @default(now())
}

model Game {
    idx         Int      @default(autoincrement()) @id
    rank        Boolean
    user_id     Int
    enemy_id    Int
    enemy_name  String   @default("enemy")
    winner      Boolean
    user        User     @relation("game_user", fields: [user_id], references: [user_id])
    my_score    Int      @default(0)
    enemy_score Int      @default(0)
    created_at  DateTime @default(now())
}

model Event {
  id            Int      @default(autoincrement()) @id
  to_id         Int
  user          User     @relation("event_user",fields: [to_id], references: [user_id])
  event_type    String
  from_nickname String
  chatroom_id   Int?
  chatroom_name String?
}